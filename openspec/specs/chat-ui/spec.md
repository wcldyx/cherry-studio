# chat-ui Specification

## Purpose
TBD - created by archiving change add-chat-tabbed-chat. Update Purpose after archive.
## Requirements
### Requirement: 聊天标签栏管理
聊天主区域 SHALL 提供浏览器式标签栏，让用户可以同时打开多个话题或 Agent Session，并在标签中快速切换、关闭、拖拽排序，且标签状态需与侧栏/快捷键保持同步。

#### Scenario: 打开并切换话题
- **WHEN** 用户在话题列表点击某个话题或通过快捷键/新建操作
- **THEN** 系统必须在标签栏中创建/激活对应标签，并在标签切换时同步消息区显示、输入区上下文

#### Scenario: 管理 Session 标签
- **WHEN** 用户切换到 Session 视图并选择某个 Agent Session
- **THEN** 该 Session 也必须以标签形式打开，支持关闭、拖拽和重新激活；关闭后若当前标签被关闭，需要自动切换到相邻标签或默认话题

#### Scenario: 状态同步
- **WHEN** 某个标签对应的话题被删除/移动或 Session 失效
- **THEN** 标签栏必须自动移除或更新该标签，防止显示空状态，并保持激活标签指向有效会话

### Requirement: 标签状态持久化
聊天界面 SHALL 持久化标签集合、顺序、激活标签以及关联会话元数据，使用户重新打开应用时可回到原本的多标签情境。

#### Scenario: 应用重启后恢复标签
- **WHEN** 用户关闭并重新打开 Cherry Studio
- **THEN** 系统必须读取上次记录的标签集合，按原顺序创建标签并激活先前聚焦的标签，同时恢复其对应会话内容与输入状态

#### Scenario: 清理失效标签
- **WHEN** 持久化记录中的话题已被删除或 Session 不再有效
- **THEN** 系统必须在恢复过程中跳过该标签并在必要时激活下一个可用标签，确保不会呈现空白或无效的会话

### Requirement: 模型自定义参数配置
“编辑模型”弹窗 SHALL 提供「自定义参数」区域，让用户以 Key-Value 或 JSON 列表形式为模型声明额外参数，这些参数需要与模型配置一起保存并在调用模型时透传给运行时。

#### Scenario: 保存并回显参数
- **WHEN** 用户在“编辑模型”弹窗新增一组自定义参数并保存
- **THEN** 系统必须将这些参数持久化到该模型配置中，并在下次打开弹窗时完整回显

#### Scenario: 切换模型自动套用
- **WHEN** 用户在对话或默认助手里切换到任意已配置自定义参数的模型
- **THEN** 系统必须自动加载该模型保存的参数，并在请求/预览中带上这些参数，无需手动复制

#### Scenario: 清除与校验
- **WHEN** 用户删除某个自定义参数或输入非法 JSON/重复 Key
- **THEN** 系统必须提供清除入口并给出即时校验提示，阻止保存非法配置，确保最终模型不会残留过期参数

#### Scenario: 复制粘贴参数集合
- **WHEN** 用户点击复制动作或将符合约定格式的参数文本粘贴到“自定义参数”区域
- **THEN** 系统必须支持一键复制当前所有参数，并在粘贴时自动解析生成多条参数项，失败时给出格式错误提示

### Requirement: 标签生成状态提示
聊天标签栏 SHALL 在每个标签上实时显示其对应话题或 Session 的回复状态，即便当前未激活，也能明确区分“空闲”“生成中”“失败”等阶段，帮助用户在多任务场景中掌握背景会话进度。

#### Scenario: 背景生成状态
- **WHEN** 用户在标签 A 中触发模型回复后立即切换到标签 B，
- **THEN** 标签 A 必须展示明显的“生成中”指示（如旋转角标或动画），直到该回复完成、取消或失败为止。

#### Scenario: 状态完成提醒
- **WHEN** 处于后台的标签生成成功或失败，
- **THEN** 标签栏必须将该标签状态更新为“完成”或“错误”提示（如绿色/红色角标，并可选触发提醒），以便用户无需切换也能判断是否需要回到该标签处理。

#### Scenario: 状态已读重置
- **WHEN** 用户重新激活一个已显示“完成/错误”状态的标签，
- **THEN** 系统在该标签进入前台并完成状态查看后，必须将其视觉状态恢复为“空闲”（即不再显示提示），防止持续提示造成干扰。

